<!DOCTYPE html>
<html lang="en">
<head>
    <title>Index</title>
    <th:block th:replace="/layout/head :: head"/>
</head>

<body>

<div >

    <header>
        <div class="row">
            <div class="col-sm-5">
                <h1>List of customers</h1>
            </div>
            <div class="col-sm-7" style="text-align: right;">
                <a class="btn btn-outline-light create-modal" style="margin-top: 10px;">
                    <i class="fa fa-plus-square-o"></i>
                    <span>Add New Customer</span>
                </a>
            </div>
        </div>
    </header>

    <table id="tbCustomer" class="table table-hover">
        <thead>
        <tr>
            <th scope="col">#</th>
            <th scope="col">FullName</th>
            <th scope="col">Email</th>
            <th scope="col">Phone</th>
            <th scope="col">Balance</th>
            <th scope="col">Province</th>
            <th scope="col">District</th>
            <th scope="col">Ward</th>
            <th scope="col">Address</th>
            <th scope="col" class="text-center">Action</th>
        </tr>
        </thead>
        <tbody>
        </tbody>
    </table>
</div>

<th:block th:replace="/customer/modal_create :: modal_create"/>

<th:block th:replace="/customer/modal_update :: modal_update"/>

<th:block th:replace="/customer/modal_deposit :: modal_deposit"/>

<th:block th:replace="/customer/modal_withdraw :: modal_withdraw"/>

<th:block th:replace="/customer/modal_transfer :: modal_transfer"/>

<th:block th:replace="/layout/script :: script"/>

</body>

<script>

    let customer = new Customer();
    let customerLocation = new Address();
    let deposit = new Deposit();
    let withdraw = new Withdraw();
    let transfer = new Transfer();

    function loadCustomers() {

        $.ajax({
            type: "GET",
            url: "http://localhost:8080/api/customers"
        })
            .done((item) => {
                $.each(item, (i, item) => {
                    let str = `
                        <tr id="tr_${item.id}">
                            <td>${item.id}</th>
                            <td>${item.fullName}</td>
                            <td>${item.email}</td>
                            <td>${item.phone}</td>
                            <td>${item.balance}</td>
                            <td>${item.location.provinceName}</td>
                            <td>${item.location.districtName}</td>
                            <td>${item.location.wardName}</td>
                            <td>${item.location.address}</td>
                             <td class="text-center">
                              <button type="button" class="btn btn-outline-secondary edit" data-id = "${item.id}"> <i class="fas fa-pen-square"></i> </button>
                              <button data-id = "${item.id}" type="button" class="btn btn-outline-success deposit" id="btnDeposit(${item.id})"> <i class="fas fa-plus"></i> </button>
                              <button data-id = "${item.id}" type="button" class="btn btn-outline-warning withdraw" id="btnWithdraw(${item.id})"> <i class="fas fa-minus"></i> </button>
                              <button data-id = "${item.id}" type="button" class="btn btn-outline-primary transfer" id="btnTransfer(${item.id})"> <i class="fas fa-exchange-alt"></i> </button>
                              <button data-id = "${item.id}" type="button" class="btn btn-outline-danger block" id="btnBlock(${item.id})"> <i class="fas fa-ban"></i> </button>
                          </td>
                        </tr>
                    `;
                    $("#tbCustomer tbody").prepend(str);
                })
                handleBtn()
                loadLocation();
            });
    }

    function doCreate() {
        customerLocation.provinceId = $("#province").val();
        customerLocation.provinceName = $("#province option:selected").text();
        customerLocation.districtId = $("#district").val();
        customerLocation.districtName = $("#district option:selected").text();
        customerLocation.wardId = $("#ward").val();
        customerLocation.wardName = $("#ward option:selected").text();
        customerLocation.address = $('#address').val();

        delete customer.id;
        customer.fullName = $('#fullName').val();
        customer.email = $('#email').val();
        customer.phone = $('#phone').val();
        customer.balance = +0;
        customer.location = customerLocation;
        customer.isDeleted = +0;

        $.ajax({
            headers: {
                "accept": "application/json",
                "content-type": "application/json"
            },
            type: "POST",
            url: "http://localhost:8080/api/customers/create",
            data: JSON.stringify(customer)
        })
            .done((data) => {

                let str = `
                    <tr id="tr_${data.id}">
                        <td>${data.id}</th>
                        <td>${data.fullName}</td>
                        <td>${data.email}</td>
                        <td>${data.phone}</td>
                         <td>${data.balance}</td>
                        <td>${data.location.provinceName}</td>
                        <td>${data.location.districtName}</td>
                        <td>${data.location.wardName}</td>
                        <td>${data.location.address}</td>
                         <td class="text-center">
                              <button type="button" class="btn btn-outline-secondary edit" data-id = "${data.id}"> <i class="fas fa-pen-square"></i> </button>
                              <button data-id = "${data.id}" type="button" class="btn btn-outline-success deposit" id="btnDeposit(${data.id})"> <i class="fas fa-plus"></i> </button>
                              <button data-id = "${data.id}" type="button" class="btn btn-outline-warning withdraw" id="btnWithdraw(${data.id})"> <i class="fas fa-minus"></i> </button>
                              <button data-id = "${data.id}" type="button" class="btn btn-outline-primary transfer" id="btnTransfer(${data.id})"> <i class="fas fa-exchange-alt"></i> </button>
                              <button data-id = "${data.id}" type="button" class="btn btn-outline-danger block" id="btnBlock(${data.id})"> <i class="fas fa-ban"></i> </button>
                         </td>
                    </tr>
                `;

                $("#tbCustomer tbody").prepend(str);

                handleBtn();

                $("#mdCreate").modal("hide");

                App.SweetAlert.showSuccessAlert("Create customer success!");
            })
            .fail((err) => {
                console.log(err);

                let str = "";
                if (err.responseJSON) {
                    $.each(err.responseJSON, (key, value) => {
                        str += `<label id = "${key}-error" class = "error" for="${key}"> ${value} </label>`;
                        $("#" + key).addClass("error");
                    })
                    $("#mdCreate .modal-alert-danger").removeClass("hide").addClass("show").append(str);
                }

                // let str = `<label id = "message-error" class = "error"> ${err.responseJSON} </label>`;


                // App.IziToast.showErrorAlert("Create customer fail!");
            });

        $("#frmCreate")[0].reset();
    }


    function doEdit() {

        delete customerLocation.id;
        customerLocation.provinceId = $("#provinceUp").val();
        customerLocation.provinceName = $("#provinceUp option:selected").text();
        customerLocation.districtId = $("#districtUp").val();
        customerLocation.districtName = $("#districtUp option:selected").text();
        customerLocation.wardId = $("#wardUp").val();
        customerLocation.wardName = $("#wardUp option:selected").text();
        customerLocation.address = $('#addressUp').val();

        customer.fullName = $('#fullNameUp').val();
        customer.email = $('#emailUp').val();
        customer.phone = $('#phoneUp').val();
        customer.location = customerLocation;

        $.ajax({
            headers: {
                "accept": "application/json",
                "content-type": "application/json"
            },
            type: "PUT",
            url: "http://localhost:8080/api/customers/edit/" + customer.id,
            data: JSON.stringify(customer)
        })
            .done((data) => {
                console.log(data);
                let str = `
                    <tr id="tr_${data.id}">
                        <td>${data.id}</th>
                        <td>${data.fullName}</td>
                        <td>${data.email}</td>
                        <td>${data.phone}</td>
                        <td>${data.balance}</td>
                        <td>${data.location.provinceName}</td>
                        <td>${data.location.districtName}</td>
                        <td>${data.location.wardName}</td>
                        <td>${data.location.address}</td>
                         <td class="text-center">
                              <button type="button" class="btn btn-outline-secondary edit" data-id = "${data.id}"> <i class="fas fa-pen-square"></i> </button>
                              <button data-id = "${data.id}" type="button" class="btn btn-outline-success deposit" id="btnDeposit(${data.id})"> <i class="fas fa-plus"></i> </button>
                              <button data-id = "${data.id}" type="button" class="btn btn-outline-warning withdraw" id="btnWithdraw(${data.id})"> <i class="fas fa-minus"></i> </button>
                              <button data-id = "${data.id}" type="button" class="btn btn-outline-primary transfer" id="btnTransfer(${data.id})"> <i class="fas fa-exchange-alt"></i> </button>
                              <button data-id = "${data.id}" type="button" class="btn btn-outline-danger block" id="btnBlock(${data.id})"> <i class="fas fa-ban"></i> </button>
                         </td>
                    </tr>
                `;

                let currentRow = $('#tr_' + data.id);
                currentRow.replaceWith(str);

                handleBtn();
                $("#mdEdit").modal("hide");

                App.SweetAlert.showSuccessAlert("Update customer success!");

            })
            .fail((err) => {
                console.log(err);

                let str = "";
                if(err.responseJSON){
                    $.each(err.responseJSON, (key, value) => {
                        str += `<label id = "${key}Up-error" class = "error" for="${key}Up"> ${value} </label>`;
                        $("#" + key).addClass("error");
                    })
                    $("#mdEdit .modal-alert-danger").removeClass("hide").addClass("show").append(str);
                }

                App.IziToast.showErrorAlert("Update customer fail!");
            })

        // $("#frmEdit")[0].reset();
    }

    function doDeposit() {
        let customerId = +$('#customerIdDep').val();
        let transactionAmount = +$('#transactionAmountDep').val();

        delete deposit.id;
        deposit.customerId = customerId;
        deposit.transactionAmount = transactionAmount;
        deposit.createdBy = 1;
        deposit.updatedBy = 1;
        deposit.isDeleted = 0;

        console.log(JSON.stringify(deposit));

        $.ajax({
            headers: {
                "accept": "application/json",
                "content-type": "application/json"
            },
            type: "POST",
            url: "http://localhost:8080/api/customers/deposit/" + customerId,
            data: JSON.stringify(deposit)
        })
            .done((data) => {
                console.log("update balance");
                console.log(data);
                let str = `
                    <tr id="tr_${data.id}">
                        <td>${data.id}</th>
                        <td>${data.fullName}</td>
                        <td>${data.email}</td>
                        <td>${data.phone}</td>
                        <td>${data.balance}</td>
                        <td>${data.location.provinceName}</td>
                        <td>${data.location.districtName}</td>
                        <td>${data.location.wardName}</td>
                        <td>${data.location.address}</td>
                         <td class="text-center">
                              <button type="button" class="btn btn-outline-secondary edit" data-id = "${data.id}"> <i class="fas fa-pen-square"></i> </button>
                              <button data-id = "${data.id}" type="button" class="btn btn-outline-success deposit" id="btnDeposit(${data.id})"> <i class="fas fa-plus"></i> </button>
                              <button data-id = "${data.id}" type="button" class="btn btn-outline-warning withdraw" id="btnWithdraw(${data.id})"> <i class="fas fa-minus"></i> </button>
                              <button data-id = "${data.id}" type="button" class="btn btn-outline-primary transfer" id="btnTransfer(${data.id})"> <i class="fas fa-exchange-alt"></i> </button>
                              <button data-id = "${data.id}" type="button" class="btn btn-outline-danger block" id="btnBlock(${data.id})"> <i class="fas fa-ban"></i> </button>
                         </td>
                    </tr>
                `;

                let currentRow = $('#tr_' + data.id);
                currentRow.replaceWith(str);


                handleBtn();

                $("#mdDeposit").modal("hide");

                App.SweetAlert.showSuccessAlert("Deposit success!");
            })
            .fail((err) => {
                console.log(err.responseJSON);

                let str = "";
                if (err.responseJSON) {
                    $.each(err.responseJSON, (key, value) => {
                        str += `<label id = "${key}Dep-error" class = "error" for="${key}Dep"> ${value} </label>`;
                        $("#" + key).addClass("error");
                    })
                    $("#mdDeposit .modal-alert-danger").removeClass("hide").addClass("show").append(str);
                }

                // let str = `<label id = "message-error" class = "error"> ${err.responseJSON} </label>`;


                App.IziToast.showErrorAlert("Deposit customer fail!");
            })
    }

    function doWithdraw(){
        let id = $('#customerIdWd').val();
        findById(id).then(function () {
            let transactionAmount = $('#transactionAmountWd').val();

            delete withdraw.id;
            withdraw.customerId = id;
            // withdraw.createAt = getDateTime();
            withdraw.createBy = 1;
            // withdraw.updateAt = getDateTime();
            withdraw.updateBy = 1;
            withdraw.isDeleted = 0;
            withdraw.transactionAmount = transactionAmount;

            console.log(withdraw);

            $.ajax({
                headers: {
                    "accept": "application/json",
                    "content-type": "application/json"
                },
                type: "POST",
                url: "http://localhost:8080/api/customers/withdraw/" + id,
                data: JSON.stringify(withdraw)
            })
                .done((data) => {
                    let str = `  <tr id = "tr_${data.id}">
                          <th scope="row">${data.id}</th>
                          <td>${data.fullName}</td>
                          <td>${data.email}</td>
                          <td>${data.phone}</td>
                          <td>${data.balance}</td>
                          <td>${data.location.provinceName}</td>
                          <td>${data.location.districtName}</td>
                          <td>${data.location.wardName}</td>
                          <td>${data.location.address}</td>
                          <td class="text-center">
                              <button type="button" class="btn btn-outline-secondary edit" data-id = "${data.id}"> <i class="fas fa-pen-square"></i> </button>
                              <button data-id = "${data.id}" type="button" class="btn btn-outline-success deposit" id="btnDeposit(${data.id})"> <i class="fas fa-plus"></i> </button>
                              <button data-id = "${data.id}" type="button" class="btn btn-outline-warning withdraw" id="btnWithdraw(${data.id})"> <i class="fas fa-minus"></i> </button>
                              <button data-id = "${data.id}" type="button" class="btn btn-outline-primary transfer" id="btnTransfer(${data.id})"> <i class="fas fa-exchange-alt"></i> </button>
                              <button data-id = "${data.id}" type="button" class="btn btn-outline-danger block" id="btnBlock(${data.id})"> <i class="fas fa-ban"></i> </button>
                          </td>
             </tr>`;
                    let currentRow = $("#tr_" + data.id);
                    currentRow.replaceWith(str);

                    handleBtn();
                    $("#mdWithdraw").modal("hide");

                    App.SweetAlert.showSuccessAlert("Withdraw success!");
                }).fail((err) => {
                console.log(err);

                let str = "";
                if (err.responseJSON) {
                    $.each(err.responseJSON, (key, value) => {
                        str += `<label id = "${key}Wd-error" class = "error" for="${key}Wd"> ${value} </label>`;
                        $("#" + key).addClass("error");
                    })
                    $("#mdWithdraw .modal-alert-danger").removeClass("hide").addClass("show").append(str);
                }
                App.IziToast.showErrorAlert("Withdraw customer fail!");
            })
        })
    }

    function doTransfer(){

        let transferAmount = $("#transferAmountTrf").val();
        let repId = $("#recipientIdTrf").val();

        delete transfer.id;
        transfer.transferAmount =  transferAmount;
        transfer.recipientId =  repId;
        transfer.senderId =  $("#senderIdTrf").val();
        console.log(transfer);

        $("#mdTransfer .modal-alert-danger").removeClass('show').addClass('hide').empty();

        $.ajax({
            headers: {
                "accept": "application/json",
                "content-type": "application/json"
            },
            type: "PUT",
            url: "http://localhost:8080/api/customers/transfers/" + transfer.senderId,
            data: JSON.stringify(transfer)
        })
            .done((data) => {
                let sender = data.sender;
                let rep = data.rep;

                let strSender = `  <tr id = "tr_${sender.id}">
                          <th scope="row">${sender.id}</th>
                          <td>${sender.fullName}</td>
                          <td>${sender.email}</td>
                          <td>${sender.phone}</td>
                          <td>${sender.balance}</td>
                          <td>${sender.location.provinceName}</td>
                          <td>${sender.location.districtName}</td>
                          <td>${sender.location.wardName}</td>
                          <td>${sender.location.address}</td>
                          <td class="text-center">
                              <button type="button" class="btn btn-outline-secondary edit" data-id = "${sender.id}"> <i class="fas fa-pen-square"></i> </button>
                              <button data-id = "${sender.id}" type="button" class="btn btn-outline-success deposit" id="btnDeposit(${sender.id})"> <i class="fas fa-plus"></i> </button>
                              <button data-id = "${sender.id}" type="button" class="btn btn-outline-warning withdraw" id="btnWithdraw(${sender.id})"> <i class="fas fa-minus"></i> </button>
                              <button data-id = "${sender.id}" type="button" class="btn btn-outline-primary transfer" id="btnTransfer(${sender.id})"> <i class="fas fa-exchange-alt"></i> </button>
                              <button data-id = "${sender.id}" type="button" class="btn btn-outline-danger block" id="btnBlock(${sender.id})"> <i class="fas fa-ban"></i> </button>
                          </td>
             </tr>`;
                let currentRowSender = $("#tr_" + sender.id);
                currentRowSender.replaceWith(strSender);
                handleBtn();


                let str = `  <tr id = "tr_${rep.id}">
                          <th scope="row">${rep.id}</th>
                          <td>${rep.fullName}</td>
                          <td>${rep.email}</td>
                          <td>${rep.phone}</td>
                          <td>${rep.balance}</td>
                          <td>${rep.location.provinceName}</td>
                          <td>${rep.location.districtName}</td>
                          <td>${rep.location.wardName}</td>
                          <td>${rep.location.address}</td>
                          <td class="text-center">
                              <button type="button" class="btn btn-outline-secondary edit" data-id = "${rep.id}"> <i class="fas fa-pen-square"></i> </button>
                              <button data-id = "${rep.id}" type="button" class="btn btn-outline-success deposit" id="btnDeposit(${rep.id})"> <i class="fas fa-plus"></i> </button>
                              <button data-id = "${rep.id}" type="button" class="btn btn-outline-warning withdraw" id="btnWithdraw(${rep.id})"> <i class="fas fa-minus"></i> </button>
                              <button data-id = "${rep.id}" type="button" class="btn btn-outline-primary transfer" id="btnTransfer(${rep.id})"> <i class="fas fa-exchange-alt"></i> </button>
                              <button data-id = "${rep.id}" type="button" class="btn btn-outline-danger block" id="btnBlock(${rep.id})"> <i class="fas fa-ban"></i> </button>
                          </td>
             </tr>`;
                let currentRow = $("#tr_" + rep.id);
                currentRow.replaceWith(str);
                handleBtn();

                $("#mdTransfer").modal("hide");
                // $("#recipientIdTrf").empty();

                App.SweetAlert.showSuccessAlert("Transfer success!");

            })
            .fail((err) => {
                console.log(err);
                let str = "";
                if (err.responseJSON) {
                    $.each(err.responseJSON, (key, value) => {
                        str += `<label id = "${key}Trf-error" class = "error" for="${key}Trf"> ${value} </label>`;
                        $("#" + key).addClass("error");
                    })
                    $("#mdTransfer .modal-alert-danger").removeClass("hide").addClass("show").append(str);
                }


                App.IziToast.showErrorAlert("Deposit customer fail!");
            })
    }


    $('.create-modal').on('click', function () {
        loadLocation();
        $('#mdCreate').modal('show');
    })

    function handleEditBtn() {
        $('.edit').on('click', function () {
            let id = $(this).data('id')
            findById(id).then(function () {

                $('#fullNameUp').val(customer.fullName);
                $('#emailUp').val(customer.email);
                $('#phoneUp').val(customer.phone);
                $('#provinceUp').val(customer.location.provinceId);


                getDistrict(customer.location.provinceId).then(function (){
                    $('#districtUp').val(customer.location.districtId);

                    getWard(customer.location.districtId).then(function () {
                        $('#wardUp').val(customer.location.wardId);
                    })
                })


                $('#addressUp').val(customer.location.address);

                $('#mdEdit').modal('show');
            });
        });
    }

    function handleDepositBtn() {
        $('.deposit').on('click', function () {

            let id = $(this).data('id');

            findById(id).then(function () {
                $('#customerIdDep').val(customer.id);
                $('#fullNameDep').val(customer.fullName);
                $('#balanceDep').val(customer.balance);

                // $('#transactionAmountDep').val(0);

                $('#mdDeposit').modal('show');
            });
        });
    }

    function handleWithdrawBtn() {
        $(".withdraw").click(function () {
            console.log("withdraw");

            let id = $(this).data("id");

            findById(id).then(function () {
                $("#customerIdWd").val(customer.id);
                $("#fullNameWd").val(customer.fullName);
                $("#balanceWd").val(customer.balance);
                $("#mdWithdraw").modal("show");
            });
        })
    }

    function handleTransferBtn() {
        $(".transfer").click(function () {

            let id = $(this).data("id");

            findById(id).then(function () {
                $("#senderIdTrf").val(customer.id);
                $("#senderNameTrf").val(customer.fullName);
                $("#emailTrf").val(customer.email);
                $("#balanceTrf").val(customer.balance);
                $("#mdTransfer").modal("show");

                showRepName(id);
                calTransactionAmount();
            });
        })
    }

    function handleBtn() {
        handleEditBtn();
        handleDepositBtn();
        handleWithdrawBtn();
        handleTransferBtn();
    }

    $('#btnCreate').on('click', function () {
        $('#mdCreate .modal-alert-danger').removeClass('show').addClass('hide');
        $("#mdCreate .modal-alert-danger").empty();
        $('#frmCreate').submit();
    });

    $('#btnEdit').on('click', function () {
        $('#mdEdit .modal-alert-danger').removeClass('show').addClass('hide');
        $("#mdEdit .modal-alert-danger").empty();
        $('#frmEdit').submit();
        // doEdit();
    })

    $("#btnDeposit").on('click', function () {
        $('#mdDeposit .modal-alert-danger').removeClass('show').addClass('hide');
        $("#mdDeposit .modal-alert-danger").empty();
        $('#frmDeposit').submit();
    })

    $("#btnWithdraw").on('click', function () {
        $('#mdWithdraw .modal-alert-danger').removeClass('show').addClass('hide');
        $("#mdWithdraw .modal-alert-danger").empty();
        $('#frmWithdraw').submit();
    })

    $("#btnTransferMoney").on('click', function () {
        $('#mdTransfer .modal-alert-danger').removeClass('show').addClass('hide');
        $("#mdTransfer .modal-alert-danger").empty();
        $('#frmTransfer').submit();
    })

    $("#mdCreate").on("hidden.bs.modal", function () {
        $("#mdCreate .modal-alert-danger").empty();
        $("#frmCreate")[0].reset();
        $('#mdCreate .modal-alert-danger').removeClass('show').addClass('hide');
    });

    $("#mdEdit").on("hidden.bs.modal", function () {
        $("#mdEdit .modal-alert-danger").empty();
        $("#mdEdit .modal-alert-danger").removeClass("show").addClass("hide");
        $("#frmEdit input.error").removeClass("error");
        $("#frmEdit")[0].reset();
        $("#frmEdit").validate().resetForm();
    });

    $("#mdDeposit").on("hidden.bs.modal", function () {
        $("#mdDeposit .modal-alert-danger").empty();
        $("#frmDeposit")[0].reset();
        $('#mdDeposit .modal-alert-danger').removeClass('show').addClass('hide');
        $("#frmDeposit").validate().resetForm();
    });

    $("#mdWithdraw").on("hidden.bs.modal", function () {
        $("#mdWithdraw .modal-alert-danger").empty();
        $("#frmWithdraw")[0].reset();
        $('#mdWithdraw .modal-alert-danger').removeClass('show').addClass('hide');
    });

    $("#mdTransfer").on("hidden.bs.modal", function () {
        $("#mdTransfer .modal-alert-danger").empty();
        // $("#recipientIdTrf").empty();
        $("#frmTransfer")[0].reset();
        $('#mdTransfer .modal-alert-danger').removeClass('show').addClass('hide');
    });



    function findById(id) {
        return $.ajax({
            type: "GET",
            url: "http://localhost:8080/api/customers/" + id
        })
            .done((data) => {
                customer = data;
            })
            .fail((err) => {
                alert("Id not found");
            })
    }



    $('#frmCreate').validate({
        // rules: {
        //     fullName: {
        //         required: true,
        //         minlength: 3,
        //         maxlength: 50
        //     },
        //     email: {
        //         required: true,
        //         email: true,
        //         minlength: 10,
        //         maxlength: 50
        //     },
        //     address: {
        //         required: false,
        //         minlength: 5,
        //         maxlength: 50
        //     }
        // },
        // messages: {
        //     fullName: {
        //         required: "Vui lòng nhập tên đầy đủ",
        //         minlength: $.validator.format("Họ tên tối thiểu {0} ký tự"),
        //         maxlength: $.validator.format("Họ tên tối đa {0} ký tự")
        //     },
        //     email: {
        //         required: "Vui lòng nhập email đầy đủ",
        //         email: "Vui lòng nhập đúng định dạng email",
        //         minlength: $.validator.format("Email tối thiểu {0} ký tự"),
        //         maxlength: $.validator.format("Email tối đa {0} ký tự")
        //     },
        //     address: {
        //         minlength: $.validator.format("Địa chỉ tối thiểu {0} ký tự"),
        //         maxlength: $.validator.format("Địa chỉ tối đa {0} ký tự")
        //     }
        // },
        // errorLabelContainer: "#mdCreate .modal-alert-danger",
        // errorPlacement: function (error, element) {
        //     error.appendTo("#mdCreate .modal-alert-danger");
        // },
        // showErrors: function(errorMap, errorList) {
        //     if (this.numberOfInvalids() > 0) {
        //         $("#mdCreate .modal-alert-danger").removeClass("hide").addClass("show");
        //     } else {
        //         $("#mdCreate .modal-alert-danger").removeClass("show").addClass("hide").empty();
        //         $("#frmCreate input.error").removeClass("error");
        //     }
        //     this.defaultShowErrors();
        // },
        submitHandler: function () {
            doCreate();
        }
    });

    $('#frmEdit').validate({
        // rules: {
        //     fullName: {
        //         required: true,
        //         minlength: 3,
        //         maxlength: 50
        //     },
        //     email: {
        //         required: true,
        //         email: true,
        //         minlength: 10,
        //         maxlength: 50
        //     },
        //     address: {
        //         required: false,
        //         minlength: 5,
        //         maxlength: 50
        //     }
        // },
        // messages: {
        //     fullName: {
        //         required: "Vui lòng nhập tên đầy đủ",
        //         minlength: $.validator.format("Họ tên tối thiểu {0} ký tự"),
        //         maxlength: $.validator.format("Họ tên tối đa {0} ký tự")
        //     },
        //     email: {
        //         required: "Vui lòng nhập email đầy đủ",
        //         email: "Vui lòng nhập đúng định dạng email",
        //         minlength: $.validator.format("Email tối thiểu {0} ký tự"),
        //         maxlength: $.validator.format("Email tối đa {0} ký tự")
        //     },
        //     address: {
        //         minlength: $.validator.format("Địa chỉ tối thiểu {0} ký tự"),
        //         maxlength: $.validator.format("Địa chỉ tối đa {0} ký tự")
        //     }
        // },
        // errorLabelContainer: "#mdEdit .modal-alert-danger",
        // errorPlacement: function (error, element) {
        //     error.appendTo("#mdEdit .modal-alert-danger");
        // },
        // showErrors: function(errorMap, errorList) {
        //     if (this.numberOfInvalids() > 0) {
        //         $("#mdEdit .modal-alert-danger").removeClass("hide").addClass("show");
        //     } else {
        //         $("#mdEdit .modal-alert-danger").removeClass("show").addClass("hide").empty();
        //         $("#frmEdit input.error").removeClass("error");
        //     }
        //     this.defaultShowErrors();
        // },
        submitHandler: function() {
            doEdit();
        }
    })

    $('#frmDeposit').validate({
        // rules: {
        //     transactionAmountDep: {
        //         required: true,
        //         number: true,
        //         min: 50,
        //         max: 100000
        //     }
        // },
        // messages: {
        //     transactionAmountDep: {
        //         required: "Vui lòng nhập số tiền giao dịch",
        //         min: $.validator.format("Số tiền giao dịch tối thiểu {0} $"),
        //         max: $.validator.format("Số tiền giao dịch tối đa {0} $"),
        //         number: "Vui lòng nhập số"
        //     }
        // },
        // errorLabelContainer: "#mdDeposit .modal-alert-danger",
        // errorPlacement: function (error, element) {
        //     error.appendTo("#mdDeposit .modal-alert-danger");
        // },
        // showErrors: function(errorMap, errorList) {
        //     if (this.numberOfInvalids() > 0) {
        //         $("#mdDeposit .modal-alert-danger").removeClass("hide").addClass("show");
        //     } else {
        //         $("#mdDeposit .modal-alert-danger").removeClass("show").addClass("hide").empty();
        //         $("#frmDeposit input.error").removeClass("error");
        //     }
        //     this.defaultShowErrors();
        // },
        submitHandler: function() {
            doDeposit();
        }
    });


    $('#frmWithdraw').validate({

        // rules: {
        //     transactionAmountWd: {
        //         required: true,
        //         number: true,
        //         min: 50,
        //         max: 100000
        //     }
        // },
        // messages: {
        //     transactionAmountWd: {
        //         required: "Vui lòng nhập số tiền giao dịch",
        //         min: $.validator.format("Số tiền giao dịch tối thiểu {0} $"),
        //         max: $.validator.format("Số tiền giao dịch tối đa {0} $"),
        //         number: "Vui lòng nhập số"
        //     }
        // },
        // errorLabelContainer: "#mdWithdraw .modal-alert-danger",
        // errorPlacement: function (error, element) {
        //     error.appendTo("#mdWithdraw .modal-alert-danger");
        // },
        // showErrors: function(errorMap, errorList) {
        //     if (this.numberOfInvalids() > 0) {
        //         $("#mdWithdraw .modal-alert-danger").removeClass("hide").addClass("show");
        //     } else {
        //         $("#mdWithdraw .modal-alert-danger").removeClass("show").addClass("hide").empty();
        //         $("#frmWithdraw input.error").removeClass("error");
        //     }
        //     this.defaultShowErrors();
        // },
        submitHandler: function() {
            doWithdraw();
        }
    })


    $('#frmTransfer').validate({
        // rules: {
        //     transferAmountTrf: {
        //         required: true,
        //         number: true,
        //         min: 50,
        //         max: 100000
        //     }
        // },
        // messages: {
        //     transferAmountTrf: {
        //         required: "Vui lòng nhập số tiền giao dịch",
        //         min: $.validator.format("Số tiền giao dịch tối thiểu {0} $"),
        //         max: $.validator.format("Số tiền giao dịch tối đa {0} $"),
        //         number: "Vui lòng nhập số"
        //     }
        // },
        // errorLabelContainer: "#mdTransfer .modal-alert-danger",
        // errorPlacement: function (error, element) {
        //     error.appendTo("#mdTransfer .modal-alert-danger");
        // },
        // showErrors: function(errorMap, errorList) {
        //     if (this.numberOfInvalids() > 0) {
        //         $("#mdTransfer .modal-alert-danger").removeClass("hide").addClass("show");
        //     } else {
        //         $("#mdTransfer .modal-alert-danger").removeClass("show").addClass("hide").empty();
        //         $("#frmTransfer input.error").removeClass("error");
        //     }
        //     this.defaultShowErrors();
        // },
        submitHandler: function() {
            doTransfer();
        }
    })



    $("#province").on("change", function () {
        let provinceId = $("#province").val();
        getDistrict(provinceId).then(function () {
            let districtId = $("#district").val();
            getWard(districtId);
        });
    })


    $("#district").on("change", function () {
        let districtId = $("#district").val();
        getWard(districtId);
    })

    $("#provinceUp").on("change", function () {

        let provinceId = $("#provinceUp").val();

        getDistrict(provinceId).then(function () {
            let districtId = $("#districtUp").val();
            getWard(districtId);
        });
    })


    $("#districtUp").on("change", function () {

        let districtId = $("#districtUp").val();
        getWard(districtId);
    })

    function loadLocation() {

        getProvince().then(function () {
            let provinceId = $("#province").val();

            getDistrict(provinceId).then(function () {
                let districtId = $("#district").val();
                getWard(districtId);
            });
        });
    }

    // function loadLocationUpdate() {
    //
    //         let provinceId = $("#provinceUp").val();
    //
    //         getDistrict(provinceId).then(function () {
    //
    //             let districtId = $("#districtUp").val();
    //             getWard(districtId);
    //         });
    //
    // }


    function getProvince() {
        return $.ajax({
            type: "GET",
            url: "https://vapi.vnappmob.com/api/province/"
        }).done((data) => {
            let province = data.results;
            $.each(province, (i, item) => {

                let str = `<option value="${item.province_id}" >${item.province_name}</option>`;
                $("#province").append(str);
                $("#provinceUp").append(str);
            })
        })
    }


    function getDistrict(id) {
        return $.ajax({
            type: "GET",
            url: "https://vapi.vnappmob.com/api/province/district/" + id
        }).done((data) => {
            $("#district").empty();
            $("#districtUp").empty();
            let district = data.results;
            $.each(district, (i, item) => {
                let str = `<option value="${item.district_id}" >${item.district_name}</option>`;
                $("#district").append(str);
                $("#districtUp").append(str);
            })
        })
    }


    function getWard(id) {
       return $.ajax({
            type: "GET",
            url: "https://vapi.vnappmob.com/api/province/ward/" + id
        }).done((data) => {
            $("#ward").empty();
            $("#wardUp").empty();
            let district = data.results;
            $.each(district, (i, item) => {
                let str = `<option value="${item.ward_id}" >${item.ward_name}</option>`;
                $("#ward").append(str);
                $("#wardUp").append(str);
            })
        })
    }

    function showRepName(id) {
        console.log("showRepName");
        $.ajax({
            type: "GET",
            url: "http://localhost:8080/api/customers"
        }).done((data) => {
            $("#recipientIdTrf").empty();
            $.each(data, (i, item) => {
                let str = `<option value="${item.id}" ${(item.id == id) ? "disabled" : ""} >(${item.id}) ${item.fullName}</option>`;
                $("#recipientIdTrf").append(str);
            })
        })
            .fail((err) => {
                alert("showRepNAme fail!");
            })
    }

    function getDateTime() {
        let today = new Date();
        let date = today.getFullYear() + '-' + (today.getMonth() + 1) + '-' + today.getDate();
        return date;
    }

    function calTransactionAmount() {
        $("#transferAmountTrf").on("input", function () {
            let transactionAmount = $("#transferAmountTrf").val();
            $("#transactionAmountTrf").val(Math.ceil(transactionAmount * 1.1));
        })
    }

    loadCustomers();
</script>


</html>